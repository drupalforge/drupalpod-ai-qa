[
  {
    "name": "CMS 1.x with all modules (ai_search SKIPPED)",
    "description": "Resolves to AI 1.x, ai_search gets skipped (needs AI 2.x)",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true,
      "ai_version_pattern": "^1\\.",
      "modules_resolved": ["ai", "ai_provider_amazeeio", "ai_agents"],
      "modules_skipped": ["ai_search"],
      "comment": "Resolves to AI 1.x, ai_search skipped (incompatible)"
    }
  },
  {
    "name": "CMS 1.x with forced AI 2.0.x",
    "description": "Force AI 2.0.x on CMS with dependency overrides",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "2.0.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_FORCE_DEPENDENCIES": "1"
    },
    "expect": {
      "should_succeed": true,
      "lenient_enabled": true,
      "lenient_packages": ["drupal/ai"],
      "ai_version_pattern": "(^dev-2\\.0\\.x$|^2\\.0\\.x-dev$)",
      "comment": "Explicit AI version allows testing 2.0.x on CMS"
    }
  },
  {
    "name": "CMS 1.x with AI 2.0.x (no force, should FAIL)",
    "description": "AI 2.0.x should fail without dependency overrides",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "2.0.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": false,
      "comment": "CMS constraints reject AI 2.0.x without overrides"
    }
  },
  {
    "name": "Core 11.x with all modules (ai_search SKIPPED)",
    "description": "Resolves to AI 1.x, ai_search skipped",
    "env": {
      "DP_STARTER_TEMPLATE": "core",
      "DP_VERSION": "11.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true,
      "modules_resolved": ["ai", "ai_provider_amazeeio", "ai_agents"],
      "modules_skipped": ["ai_search"],
      "comment": "Resolves to AI 1.x, ai_search skipped"
    }
  },
  {
    "name": "Core 11.x with forced AI 2.0.x",
    "description": "Force AI 2.0.x on core",
    "env": {
      "DP_STARTER_TEMPLATE": "core",
      "DP_VERSION": "11.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "2.0.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_FORCE_DEPENDENCIES": "1"
    },
    "expect": {
      "should_succeed": true,
      "lenient_enabled": true,
      "lenient_packages": ["drupal/ai"],
      "ai_version_pattern": "(^dev-2\\.0\\.x$|^2\\.0\\.x-dev$)",
      "modules_resolved": ["ai", "ai_search", "ai_agents"],
      "modules_skipped": ["ai_provider_amazeeio"]
    }
  },
  {
    "name": "Drupal 10.4.x with all modules (ai_search SKIPPED)",
    "description": "Older core with all modules",
    "env": {
      "DP_STARTER_TEMPLATE": "core",
      "DP_VERSION": "10.4.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true,
      "modules_resolved": ["ai", "ai_provider_amazeeio", "ai_agents"],
      "modules_skipped": ["ai_search"]
    }
  },
  {
    "name": "DP_TEST_MODULE: ai_seo with all modules (ai_search, ai_provider_amazeeio SKIPPED)",
    "description": "Test ai_seo module - ai_search and ai_provider_amazeeio skipped",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_TEST_MODULE": "ai_seo",
      "DP_TEST_MODULE_VERSION": ""
    },
    "expect": {
      "should_succeed": true,
      "ai_version_pattern": "^1\\.",
      "modules_resolved": ["ai", "ai_seo"],
      "modules_skipped": ["ai_search", "ai_provider_amazeeio"],
      "comment": "ai_seo drives AI 1.x; ai_search + ai_provider_amazeeio skipped"
    }
  },
  {
    "name": "DP_TEST_MODULE: ai_seo with forced AI 2.0.x (should FAIL)",
    "description": "Force AI 2.0.x but ai_seo requires AI ^1 - test module fails",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "2.0.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_TEST_MODULE": "ai_seo",
      "DP_TEST_MODULE_VERSION": ""
    },
    "expect": {
      "should_succeed": false,
      "comment": "AI 2.x explicit, but ai_seo requires AI ^1 - test module incompatible"
    }
  },
  {
    "name": "DP_TEST_MODULE: ai_seo explicit with AI 2.0.x (should FAIL)",
    "description": "Explicit versions still conflict with ai_seo requirements",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "2.0.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_TEST_MODULE": "ai_seo",
      "DP_TEST_MODULE_VERSION": "1.0.7"
    },
    "expect": {
      "should_succeed": false,
      "comment": "ai_seo 1.0.7 requires AI ^1"
    }
  },
  {
    "name": "Test AI module PR branch",
    "description": "Test a PR for the base AI module",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "1.2.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_AI_ISSUE_FORK": "3493720",
      "DP_AI_ISSUE_BRANCH": "3493720-some-feature",
      "run_clone": false
    },
    "expect": {
      "should_succeed": true,
      "modules_resolved": ["ai", "ai_provider_amazeeio", "ai_agents"],
      "modules_skipped": ["ai_search"],
      "comment": "PR branch cloned for AI module, resolves to AI 1.x"
    }
  },
  {
    "name": "Test module PR branch",
    "description": "Test a PR for ai_seo test module",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_TEST_MODULE": "ai_seo",
      "DP_TEST_MODULE_VERSION": "1.0.7",
      "DP_TEST_MODULE_ISSUE_FORK": "3500000",
      "DP_TEST_MODULE_ISSUE_BRANCH": "3500000-fix-bug",
      "run_clone": false
    },
    "expect": {
      "should_succeed": true,
      "modules_resolved": ["ai", "ai_seo"],
      "modules_skipped": ["ai_search", "ai_provider_amazeeio", "ai_agents"],
      "comment": "PR branch cloned for test module"
    }
  },
  {
    "name": "CMS 1.2.9 baseline",
    "description": "CMS release with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.2.9",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "CMS 2.0.0-rc1 baseline",
    "description": "CMS release candidate with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "2.0.0-rc1",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "CMS 2.0.x baseline",
    "description": "CMS dev branch with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "2.0.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "CMS 1.2.x baseline",
    "description": "CMS dev branch with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.2.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "Core 11.2.10 baseline",
    "description": "Core release with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "core",
      "DP_VERSION": "11.2.10",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "Core 10.6.2 baseline",
    "description": "Core release with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "core",
      "DP_VERSION": "10.6.2",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "Core 10.6.x baseline",
    "description": "Core dev branch with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "core",
      "DP_VERSION": "10.6.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "Core 10.4 baseline",
    "description": "Core minor branch with default AI version resolution",
    "env": {
      "DP_STARTER_TEMPLATE": "core",
      "DP_VERSION": "10.4",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "CMS with AI 1.2.5",
    "description": "Explicit AI version on CMS",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.2.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "1.2.5",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "CMS with AI 1.1.8",
    "description": "Explicit AI version on CMS",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.2.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "1.1.8",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents"
    },
    "expect": {
      "should_succeed": true
    }
  },
  {
    "name": "CMS with AI 1.0.x",
    "description": "Explicit AI branch on CMS",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.2.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "1.0.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_FORCE_DEPENDENCIES": "1"
    },
    "expect": {
      "should_succeed": true,
      "lenient_enabled": true,
      "lenient_packages": ["drupal/ai"]
    }
  },
  {
    "name": "CMS with AI 2.0.x (forced)",
    "description": "Explicit AI 2.0.x on CMS with dependency overrides",
    "env": {
      "DP_STARTER_TEMPLATE": "cms",
      "DP_VERSION": "1.2.x",
      "DP_AI_MODULE": "ai",
      "DP_AI_MODULE_VERSION": "2.0.x",
      "DP_AI_MODULES": "ai_provider_amazeeio,ai_search,ai_agents",
      "DP_FORCE_DEPENDENCIES": "1"
    },
    "expect": {
      "should_succeed": true,
      "lenient_enabled": true,
      "lenient_packages": ["drupal/ai"]
    }
  }
]
